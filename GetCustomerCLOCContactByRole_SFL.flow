//Girish

<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>62.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <description>This element will assign role value as &apos;DocuSign&apos; for each iteration.</description>
        <name>Assign_Default_Role_Value</name>
        <label>Assign Default Role Value</label>
        <locationX>650</locationX>
        <locationY>458</locationY>
        <assignmentItems>
            <assignToReference>CLOCContactRoleFilter</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>DocuSign</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Filter_App_Specific_Contacts_By_Role</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add the current contact to the output collection.</description>
        <name>CLOC_Contact_Assignment</name>
        <label>CLOC Contact Assignment</label>
        <locationX>666</locationX>
        <locationY>998</locationY>
        <assignmentItems>
            <assignToReference>CLOCContactList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CLOC_Contacts_Filter_Loop</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContactIdList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CLOC_Contacts_Filter_Loop.Contact_Name__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ProcessedCLOCApplicationsIdList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_CLOC_Applications</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CLOC_Contacts_Filter_Loop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assign Primary value to role variable when no DocuSign contacts were found.</description>
        <name>Role_Value_Assignment</name>
        <label>Role Value Assignment</label>
        <locationX>618</locationX>
        <locationY>782</locationY>
        <assignmentItems>
            <assignToReference>CLOCContactRoleFilter</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Primary</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Filter_App_Specific_Contacts_By_Role</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <description>Returns a filtered subset of CLOC contacts that match criteria for this application (Role and current CLOC App Id).[Note: Get Records cannot be filtered with Multi Picklist values]</description>
        <name>Filter_App_Specific_Contacts_By_Role</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter CLOCApp Specific Contacts By Role</label>
        <locationX>650</locationX>
        <locationY>566</locationY>
        <assignNextValueToReference>currentItem_Filter_App_Specific_Contacts_By_Role</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_CLOC_Contacts</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_App_Specific_Contacts_By_Role.Contact_Roles__c</leftValueReference>
            <operator>Contains</operator>
            <rightValue>
                <elementReference>CLOCContactRoleFilter</elementReference>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_Filter_App_Specific_Contacts_By_Role.CLOC_Application__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>Loop_CLOC_Applications</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Were_CLOC_Contacts_available</targetReference>
        </connector>
    </collectionProcessors>
    <decisions>
        <description>Determines whether the input CLOC App list is null or not.</description>
        <name>Null_Check_For_CLOC_App_Input_List</name>
        <label>Null Check For CLOC App Input List</label>
        <locationX>182</locationX>
        <locationY>134</locationY>
        <defaultConnectorLabel>Null</defaultConnectorLabel>
        <rules>
            <name>Not_Null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CLOCAppIdList</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_CLOC_Contacts</targetReference>
            </connector>
            <label>Not Null</label>
        </rules>
    </decisions>
    <decisions>
        <description>This decision determines if the CLOC Contact currently being processed is already present within the output collection. This check ensures that only unique contact records are added, preventing duplicates. Also it will make sure the a CLOC Application record has only one Contact by checking ProcessedCLOCApplicationIdList.</description>
        <name>Unique_Contact_Found</name>
        <label>Unique Contact Found?</label>
        <locationX>578</locationX>
        <locationY>890</locationY>
        <defaultConnector>
            <targetReference>CLOC_Contact_Assignment</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes</defaultConnectorLabel>
        <rules>
            <name>No</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ContactIdList</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>CLOC_Contacts_Filter_Loop.Contact_Name__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>ProcessedCLOCApplicationsIdList</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_CLOC_Applications</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CLOC_Contacts_Filter_Loop</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <description>Branch based on whether filtered contacts are found in the previous step.</description>
        <name>Were_CLOC_Contacts_available</name>
        <label>Were CLOC Contacts available?</label>
        <locationX>650</locationX>
        <locationY>674</locationY>
        <defaultConnector>
            <targetReference>Loop_CLOC_Applications</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>None</defaultConnectorLabel>
        <rules>
            <name>Yes_CC</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Filter_App_Specific_Contacts_By_Role</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CLOC_Contacts_Filter_Loop</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
        <rules>
            <name>No_CC</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Filter_App_Specific_Contacts_By_Role</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CLOCContactRoleFilter</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Primary</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Role_Value_Assignment</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <description>Used in CLOC. This subflow identifies valid customer contacts for a given list of CLOC Application IDs. It prioritizes finding a Contact with the &apos;DocuSign&apos; role. If a &apos;DocuSign&apos; role contact is not found for a specific CLOC Application, it then checks for a &apos;Primary&apos; contact role. The identified Contact ID for each CLOC Application is returned as an output list of Contact IDs. - CCC1-786</description>
    <environments>Default</environments>
    <interviewLabel>CLOC_SFL_GetCustomerContactByRole {!$Flow.CurrentDateTime}</interviewLabel>
    <label>GetCustomerCLOCContactByRole SFL</label>
    <loops>
        <description>Iterate through the latest contact in the filtered collection to add the latest contact available for current CLOC App id in the output collection.</description>
        <name>CLOC_Contacts_Filter_Loop</name>
        <label>CLOC Contacts Filter Loop</label>
        <locationX>402</locationX>
        <locationY>782</locationY>
        <collectionReference>Filter_App_Specific_Contacts_By_Role</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Unique_Contact_Found</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_CLOC_Applications</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Iterate over each CLOC Application ID in the input list.</description>
        <name>Loop_CLOC_Applications</name>
        <label>Loop CLOC Applications</label>
        <locationX>50</locationX>
        <locationY>350</locationY>
        <collectionReference>CLOCAppIdList</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Default_Role_Value</targetReference>
        </nextValueConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Query Contact records related to the input CLOC Application ID list and add them to a collection.</description>
        <name>Get_CLOC_Contacts</name>
        <label>Get CLOC Contacts</label>
        <locationX>50</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_CLOC_Applications</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>CLOC_Application__c</field>
            <operator>In</operator>
            <value>
                <elementReference>CLOCAppIdList</elementReference>
            </value>
        </filters>
        <filters>
            <field>Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>CLOC Contact</stringValue>
            </value>
        </filters>
        <filters>
            <field>Contact_Name__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>CLOC_Application_Contact__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Contact_Roles__c</queriedFields>
        <queriedFields>Contact_Name__c</queriedFields>
        <queriedFields>CLOC_Application__c</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>56</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Null_Check_For_CLOC_App_Input_List</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <description>This variable acts as input of this flow and it will hold the CLOC Application record id list from the parent flow.</description>
        <name>CLOCAppIdList</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>This variable acts as output from this flow and it will return the CLOC contact record list for each CLOC App Id to the parent flow.</description>
        <name>CLOCContactList</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>CLOC_Application_Contact__c</objectType>
    </variables>
    <variables>
        <description>This variable is used to store the contact role value of &quot;Primary&quot; or &quot;Docusign&quot; dynamically in the flow business logic.</description>
        <name>CLOCContactRoleFilter</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>This variable is used to store unique contact id for each CLOC Application contact.</description>
        <name>ContactIdList</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>currentItem_Filter_App_Specific_Contacts_By_Role</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CLOC_Application_Contact__c</objectType>
    </variables>
    <variables>
        <description>This variable stores the CLOC Application ID once a valid contact has been found for that specific CLOC Application. It is then used in the entry condition to ignore already processed CLOC Applications.</description>
        <name>ProcessedCLOCApplicationsIdList</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
